!function(t,r){"function"==typeof define&&define.amd?define([],(function(){return t.ArucoMarker=r()})):"object"==typeof exports?module.exports=r():t.ArucoMarker=r()}(this,(function(){function t(t){if(t<0||t>1023)throw new RangeError("Marker ID must be in the range [0..1023]");this.id=t}return t.prototype={markerMatrix:function(){var t,r,e,o=[16,23,9,14],n=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]];for(e=0;e<5;e++)for(t=o[this.id>>2*(4-e)&3],r=0;r<5;r++)n[r][e]=t>>4-r&1?1:0;return n},toSVG:function(t){var r,e,o,n=this.markerMatrix();for(o="<svg "+(t=t?'height="'+t+'" width="'+t+'"':"")+' viewBox="0 0 7 7" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <rect x="0" y="0" width="7" height="7" fill="black"/>\n',e=0;e<5;e++)for(r=0;r<5;r++)1===n[r][e]&&(o+='  <rect x="'+(r+1)+'" y="'+(e+1)+'" width="1" height="1" fill="white" stroke="white" stroke-width="0.01" />\n');return o+"</svg>"}},t})),function(t){if(!t.numeric){var r={dim:function(t){var e;return"object"==typeof t?"object"==typeof(e=t[0])?"object"==typeof e[0]?r._dim(t):[t.length,e.length]:[t.length]:[]},_foreach2:function t(r,e,o,n){if(o===e.length-1)return n(r);var i,s=e[o],a=Array(s);for(i=s-1;i>=0;i--)a[i]=t(r[i],e,o+1,n);return a},cloneV:function(t){var r,e=t.length,o=Array(e);for(r=e-1;-1!==r;--r)o[r]=t[r];return o},clone:function(t){if("object"!=typeof t)return t;var e=r.cloneV,o=r.dim(t);return r._foreach2(t,o,0,e)},diag:function(t){var r,e,o,n,i=t.length,s=Array(i);for(r=i-1;r>=0;r--){for(n=Array(i),e=r+2,o=i-1;o>=e;o-=2)n[o]=0,n[o-1]=0;for(o>r&&(n[o]=0),n[r]=t[r],o=r-1;o>=1;o-=2)n[o]=0,n[o-1]=0;0===o&&(n[0]=0),s[r]=n}return s},rep:function(t,e,o){void 0===o&&(o=0);var n,i=t[o],s=Array(i);if(o===t.length-1){for(n=i-2;n>=0;n-=2)s[n+1]=e,s[n]=e;return-1===n&&(s[0]=e),s}for(n=i-1;n>=0;n--)s[n]=r.rep(t,e,o+1);return s},identity:function(t){return r.diag(r.rep([t],1))},inv:function(t){var e,o,n,i,s,a,h,c,f=r.dim(t),u=Math.abs,d=f[0],l=f[1],V=r.clone(t),x=r.identity(d);for(a=0;l>a;++a){var v=-1,y=-1;for(s=a;s!==d;++s)(h=u(V[s][a]))>y&&(v=s,y=h);for(o=V[v],V[v]=V[a],V[a]=o,i=x[v],x[v]=x[a],x[a]=i,c=o[a],h=a;h!==l;++h)o[h]/=c;for(h=l-1;-1!==h;--h)i[h]/=c;for(s=d-1;-1!==s;--s)if(s!==a){for(n=x[s],c=(e=V[s])[a],h=a+1;h!==l;++h)e[h]-=o[h]*c;for(h=l-1;h>0;--h)n[h]-=i[h]*c,n[--h]-=i[h]*c;0===h&&(n[0]-=i[0]*c)}}return x},dotMMsmall:function(t,r){var e,o,n,i,s,a,h,c,f,u,d;for(i=t.length,s=r.length,a=r[0].length,h=Array(i),e=i-1;e>=0;e--){for(c=Array(a),f=t[e],n=a-1;n>=0;n--){for(u=f[s-1]*r[s-1][n],o=s-2;o>=1;o-=2)u+=f[o]*r[o][n]+f[d=o-1]*r[d][n];0===o&&(u+=f[0]*r[0][n]),c[n]=u}h[e]=c}return h},dotMV:function(t,e){var o,n=t.length,i=Array(n),s=r.dotVV;for(o=n-1;o>=0;o--)i[o]=s(t[o],e);return i},dotVV:function(t,r){var e,o,n=t.length,i=t[n-1]*r[n-1];for(e=n-2;e>=1;e-=2)i+=t[e]*r[e]+t[o=e-1]*r[o];return 0===e&&(i+=t[0]*r[0]),i},transpose:function(t){var r,e,o,n,i,s=t.length,a=t[0].length,h=Array(a);for(e=0;a>e;e++)h[e]=Array(s);for(r=s-1;r>=1;r-=2){for(n=t[r],o=t[r-1],e=a-1;e>=1;--e)(i=h[e])[r]=n[e],i[r-1]=o[e],(i=h[--e])[r]=n[e],i[r-1]=o[e];0===e&&((i=h[0])[r]=n[0],i[r-1]=o[0])}if(0===r){for(o=t[0],e=a-1;e>=1;--e)h[e][0]=o[e],h[--e][0]=o[e];0===e&&(h[0][0]=o[0])}return h}};this.numeric=r,t.numeric=r}}(this),function(t,r){"object"==typeof exports&&void 0!==typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.PerspT=r()}(this,(function(){"use strict";function t(t){return Math.round(1e10*t)/1e10}function r(r,e,o){if(o){var n=e;e=r,r=n}var i,s=[[r[0],r[1],1,0,0,0,-1*e[0]*r[0],-1*e[0]*r[1]],[0,0,0,r[0],r[1],1,-1*e[1]*r[0],-1*e[1]*r[1]],[r[2],r[3],1,0,0,0,-1*e[2]*r[2],-1*e[2]*r[3]],[0,0,0,r[2],r[3],1,-1*e[3]*r[2],-1*e[3]*r[3]],[r[4],r[5],1,0,0,0,-1*e[4]*r[4],-1*e[4]*r[5]],[0,0,0,r[4],r[5],1,-1*e[5]*r[4],-1*e[5]*r[5]],[r[6],r[7],1,0,0,0,-1*e[6]*r[6],-1*e[6]*r[7]],[0,0,0,r[6],r[7],1,-1*e[7]*r[6],-1*e[7]*r[7]]],a=e;try{i=numeric.inv(numeric.dotMMsmall(numeric.transpose(s),s))}catch(u){return console.log(u),[1,0,0,0,1,0,0,0]}for(var h=numeric.dotMMsmall(i,numeric.transpose(s)),c=numeric.dotMV(h,a),f=0;f<c.length;f++)c[f]=t(c[f]);return c[8]=1,c}function e(t,o){return"undefined"!=typeof window&&window===this||void 0===this?new e(t,o):(this.srcPts=t,this.dstPts=o,this.coeffs=r(this.srcPts,this.dstPts,!1),this.coeffsInv=r(this.srcPts,this.dstPts,!0),this)}return e.prototype={transform:function(t,r){var e=[];return e[0]=(this.coeffs[0]*t+this.coeffs[1]*r+this.coeffs[2])/(this.coeffs[6]*t+this.coeffs[7]*r+1),e[1]=(this.coeffs[3]*t+this.coeffs[4]*r+this.coeffs[5])/(this.coeffs[6]*t+this.coeffs[7]*r+1),e},transformInverse:function(t,r){var e=[];return e[0]=(this.coeffsInv[0]*t+this.coeffsInv[1]*r+this.coeffsInv[2])/(this.coeffsInv[6]*t+this.coeffsInv[7]*r+1),e[1]=(this.coeffsInv[3]*t+this.coeffsInv[4]*r+this.coeffsInv[5])/(this.coeffsInv[6]*t+this.coeffsInv[7]*r+1),e}},e})),(CV=CV||{}).Image=function(t,r,e){this.width=t||0,this.height=r||0,this.data=e||[]},CV.grayscale=function(t,r){for(var e=t.data,o=r.data,n=e.length,i=0,s=0;i<n;i+=4)o[s++]=.299*e[i]+.587*e[i+1]+.114*e[i+2]+.5&255;return r.width=t.width,r.height=t.height,r},CV.threshold=function(t,r,e){var o,n=t.data,i=r.data,s=n.length,a=[];for(o=0;o<256;++o)a[o]=o<=e?0:255;for(o=0;o<s;++o)i[o]=a[n[o]];return r.width=t.width,r.height=t.height,r},CV.adaptiveThreshold=function(t,r,e,o){var n,i=t.data,s=r.data,a=i.length,h=[];for(CV.stackBoxBlur(t,r,e),n=0;n<768;++n)h[n]=n-255<=-o?255:0;for(n=0;n<a;++n)s[n]=h[i[n]-s[n]+255];return r.width=t.width,r.height=t.height,r},CV.otsu=function(t){var r,e,o,n=t.data,i=n.length,s=[],a=0,h=0,c=0,f=0,u=0,d=0;for(o=0;o<256;++o)s[o]=0;for(o=0;o<i;++o)s[n[o]]++;for(o=0;o<256;++o)h+=s[o]*o;for(o=0;o<256;++o)if(0!==(f+=s[o])){if(0==(u=i-f))break;(e=f*u*(r=(c+=s[o]*o)/f-(h-c)/u)*r)>d&&(d=e,a=o)}return a},CV.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265],CV.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13],CV.BlurStack=function(){this.color=0,this.next=null},CV.stackBoxBlur=function(t,r,e){var o,n,i,s,a,h,c,f,u,d,l=t.data,V=r.data,x=t.height,v=t.width,y=x-1,p=v-1,m=e+e+1,g=e+1,b=CV.stackBoxBlurMult[e],M=CV.stackBoxBlurShift[e];for(o=n=new CV.BlurStack,d=1;d<m;++d)o=o.next=new CV.BlurStack;for(o.next=n,a=0,u=0;u<x;++u){for(h=a,s=g*(i=l[a]),o=n,d=0;d<g;++d)o.color=i,o=o.next;for(d=1;d<g;++d)o.color=l[a+d],s+=o.color,o=o.next;for(o=n,f=0;f<v;++f)V[a++]=s*b>>>M,s-=o.color-l[c=h+((c=f+g)<p?c:p)],o.color=l[c],o=o.next}for(f=0;f<v;++f){for(h=(a=f)+v,s=g*(i=V[a]),o=n,d=0;d<g;++d)o.color=i,o=o.next;for(d=1;d<g;++d)o.color=V[h],s+=o.color,o=o.next,h+=v;for(o=n,u=0;u<x;++u)V[a]=s*b>>>M,s-=o.color-V[c=f+((c=u+g)<y?c:y)*v],o.color=V[c],o=o.next,a+=v}return r},CV.gaussianBlur=function(t,r,e,o){var n=CV.gaussianKernel(o);return r.width=t.width,r.height=t.height,e.width=t.width,e.height=t.height,CV.gaussianBlurFilter(t,e,n,!0),CV.gaussianBlurFilter(e,r,n,!1),r},CV.gaussianBlurFilter=function(t,r,e,o){var n,i,s,a,h,c=t.data,f=r.data,u=t.height,d=t.width,l=0,V=e.length>>1;for(s=0;s<u;++s)for(a=0;a<d;++a){for(i=0,h=-V;h<=V;++h)o?(n=l+h,(a+h<0||a+h>=d)&&(n=l)):(n=l+h*d,(s+h<0||s+h>=u)&&(n=l)),i+=e[V+h]*c[n];f[l++]=o?i:i+.5&255}return r},CV.gaussianKernel=function(t){var r,e,o,n,i,s,a=[];if(t<=7&&t%2==1)a=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]][t>>1];else{for(o=-.5/((e=.8+.3*((r=.5*(t-1))-1))*e),n=0,s=0;s<t;++s)i=s-r,n+=a[s]=Math.exp(o*i*i);for(n=1/n,s=0;s<t;++s)a[s]*=n}return a},CV.findContours=function(t,r){var e,o,n,i,s,a,h,c,f,u=t.width,d=t.height,l=[];for(e=CV.binaryBorder(t,r),o=CV.neighborhoodDeltas(u+2),n=u+3,s=1,c=0;c<d;++c,n+=2)for(f=0;f<u;++f,++n)0!==(i=e[n])&&(a=h=!1,1===i&&0===e[n-1]?a=!0:i>=1&&0===e[n+1]&&(h=!0),(a||h)&&(++s,l.push(CV.borderFollowing(e,n,s,{x:f,y:c},h,o))));return l},CV.borderFollowing=function(t,r,e,o,n,i){var s,a,h,c,f,u=[];u.hole=n,c=f=n?0:4;do{if(0!==t[s=r+i[c=c-1&7]])break}while(c!==f);if(c===f)t[r]=-e,u.push({x:o.x,y:o.y});else for(a=r;;){f=c;do{h=a+i[++c]}while(0===t[h]);if((c&=7)-1>>>0<f>>>0?t[a]=-e:1===t[a]&&(t[a]=e),u.push({x:o.x,y:o.y}),o.x+=CV.neighborhood[c][0],o.y+=CV.neighborhood[c][1],h===r&&a===s)break;a=h,c=c+4&7}return u},CV.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],CV.neighborhoodDeltas=function(t){for(var r=[],e=CV.neighborhood.length,o=0;o<e;++o)r[o]=CV.neighborhood[o][0]+CV.neighborhood[o][1]*t;return r.concat(r)},CV.approxPolyDP=function(t,r){var e,o,n,i,s,a,h,c,f,u,d,l={start_index:0,end_index:0},V={start_index:0,end_index:0},x=[],v=[],y=t.length;for(r*=r,d=0,f=0;f<3;++f)for(s=0,o=t[d=(d+V.start_index)%y],++d===y&&(d=0),u=1;u<y;++u)e=t[d],++d===y&&(d=0),(i=(h=e.x-o.x)*h+(c=e.y-o.y)*c)>s&&(s=i,V.start_index=u);for(s<=r?x.push({x:o.x,y:o.y}):(l.start_index=d,l.end_index=V.start_index+=l.start_index,V.start_index-=V.start_index>=y?y:0,V.end_index=l.start_index,V.end_index<V.start_index&&(V.end_index+=y),v.push({start_index:V.start_index,end_index:V.end_index}),v.push({start_index:l.start_index,end_index:l.end_index}));0!==v.length;){if(n=t[(l=v.pop()).end_index%y],o=t[d=l.start_index%y],++d===y&&(d=0),l.end_index<=l.start_index+1)a=!0;else{for(s=0,h=n.x-o.x,c=n.y-o.y,f=l.start_index+1;f<l.end_index;++f)e=t[d],++d===y&&(d=0),(i=Math.abs((e.y-o.y)*h-(e.x-o.x)*c))>s&&(s=i,V.start_index=f);a=s*s<=r*(h*h+c*c)}a?x.push({x:o.x,y:o.y}):(V.end_index=l.end_index,l.end_index=V.start_index,v.push({start_index:V.start_index,end_index:V.end_index}),v.push({start_index:l.start_index,end_index:l.end_index}))}return x},CV.warp=function(t,r,e,o){var n,i,s,a,h,c,f,u,d,l,V,x,v,y,p,m,g,b,M,w,P,C=t.data,j=r.data,S=t.width,_=t.height,D=0;for(x=(V=CV.getPerspectiveTransform(e,o-1))[8],v=V[2],y=V[5],w=0;w<o;++w)for(p=x+=V[7],m=v+=V[1],g=y+=V[4],P=0;P<o;++P)f=u=(h=(M=(g+=V[3])/(p+=V[6]))>>>0)*S,d=l=(h===_-1?h:h+1)*S,j[D++]=(1-(c=M-h))*((a=1-(s=(b=(m+=V[0])/p)-(n=b>>>0)))*C[f+n]+s*C[u+(i=n===S-1?n:n+1)])+c*(a*C[d+n]+s*C[l+i])&255;return r.width=o,r.height=o,r},CV.getPerspectiveTransform=function(t,r){var e=CV.square2quad(t);return e[0]/=r,e[1]/=r,e[3]/=r,e[4]/=r,e[6]/=r,e[7]/=r,e},CV.square2quad=function(t){var r,e,o,n,i,s,a,h=[];return e=t[0].y-t[1].y+t[2].y-t[3].y,0==(r=t[0].x-t[1].x+t[2].x-t[3].x)&&0===e?(h[0]=t[1].x-t[0].x,h[1]=t[2].x-t[1].x,h[2]=t[0].x,h[3]=t[1].y-t[0].y,h[4]=t[2].y-t[1].y,h[5]=t[0].y,h[6]=0,h[7]=0,h[8]=1):(h[6]=(r*(s=t[3].y-t[2].y)-(n=t[3].x-t[2].x)*e)/(a=(o=t[1].x-t[2].x)*s-n*(i=t[1].y-t[2].y)),h[7]=(o*e-r*i)/a,h[8]=1,h[0]=t[1].x-t[0].x+h[6]*t[1].x,h[1]=t[3].x-t[0].x+h[7]*t[3].x,h[2]=t[0].x,h[3]=t[1].y-t[0].y+h[6]*t[1].y,h[4]=t[3].y-t[0].y+h[7]*t[3].y,h[5]=t[0].y),h},CV.isContourConvex=function(t){var r,e,o,n,i,s,a,h,c=0,f=!0,u=t.length,d=0,l=0;for(i=(r=t[0]).x-(e=t[u-1]).x,s=r.y-e.y;d<u;++d){if(++l===u&&(l=0),e=r,3==(c|=(n=(h=(r=t[l]).y-e.y)*i)>(o=(a=r.x-e.x)*s)?1:n<o?2:3)){f=!1;break}i=a,s=h}return f},CV.perimeter=function(t){for(var r,e,o=t.length,n=0,i=o-1,s=0;n<o;i=n++)r=t[n].x-t[i].x,e=t[n].y-t[i].y,s+=Math.sqrt(r*r+e*e);return s},CV.minEdgeLength=function(t){for(var r,e,o,n=t.length,i=0,s=n-1,a=1/0;i<n;s=i++)(r=(e=t[i].x-t[s].x)*e+(o=t[i].y-t[s].y)*o)<a&&(a=r);return Math.sqrt(a)},CV.countNonZero=function(t,r){var e,o,n=t.data,i=r.height,s=r.width,a=r.x+r.y*t.width,h=t.width-s,c=0;for(e=0;e<i;++e){for(o=0;o<s;++o)0!==n[a++]&&++c;a+=h}return c},CV.binaryBorder=function(t,r){var e,o,n=t.data,i=t.height,s=t.width,a=0,h=0;for(o=-2;o<s;++o)r[h++]=0;for(e=0;e<i;++e){for(r[h++]=0,o=0;o<s;++o)r[h++]=0===n[a++]?0:1;r[h++]=0}for(o=-2;o<s;++o)r[h++]=0;return r},module.exports=CV;var CV=require("./cv"),AR=AR||{};AR.Marker=function(t,r){this.id=t,this.corners=r},AR.Detector=function(){this.grey=new CV.Image,this.thres=new CV.Image,this.homography=new CV.Image,this.binary=[],this.contours=[],this.polys=[],this.candidates=[]},AR.Detector.prototype.detect=function(t){return CV.grayscale(t,this.grey),CV.adaptiveThreshold(this.grey,this.thres,2,7),this.contours=CV.findContours(this.thres,this.binary),this.candidates=this.findCandidates(this.contours,.2*t.width,.05,10),this.candidates=this.clockwiseCorners(this.candidates),this.candidates=this.notTooNear(this.candidates,10),this.findMarkers(this.grey,this.candidates,49)},AR.Detector.prototype.findCandidates=function(t,r,e,o){var n,i,s,a=[],h=t.length;for(this.polys=[],s=0;s<h;++s)(n=t[s]).length>=r&&(i=CV.approxPolyDP(n,n.length*e),this.polys.push(i),4===i.length&&CV.isContourConvex(i)&&CV.minEdgeLength(i)>=o&&a.push(i));return a},AR.Detector.prototype.clockwiseCorners=function(t){var r,e,o=t.length;for(e=0;e<o;++e)(t[e][1].x-t[e][0].x)*(t[e][2].y-t[e][0].y)-(t[e][1].y-t[e][0].y)*(t[e][2].x-t[e][0].x)<0&&(r=t[e][1],t[e][1]=t[e][3],t[e][3]=r);return t},AR.Detector.prototype.notTooNear=function(t,r){var e,o,n,i,s,a,h=[],c=t.length;for(i=0;i<c;++i)for(s=i+1;s<c;++s){for(e=0,a=0;a<4;++a)e+=(o=t[i][a].x-t[s][a].x)*o+(n=t[i][a].y-t[s][a].y)*n;e/4<r*r&&(CV.perimeter(t[i])<CV.perimeter(t[s])?t[i].tooNear=!0:t[s].tooNear=!0)}for(i=0;i<c;++i)t[i].tooNear||h.push(t[i]);return h},AR.Detector.prototype.findMarkers=function(t,r,e){var o,n,i,s=[],a=r.length;for(i=0;i<a;++i)CV.warp(t,this.homography,o=r[i],e),CV.threshold(this.homography,this.homography,CV.otsu(this.homography)),(n=this.getMarker(this.homography,o))&&s.push(n);return s},AR.Detector.prototype.getMarker=function(t,r){var e,o,n,i,s=t.width/7>>>0,a=s*s>>1,h=[],c=[],f=[];for(n=0;n<7;++n)for(o=0===n||6===n?1:6,i=0;i<7;i+=o)if(CV.countNonZero(t,{x:i*s,y:n*s,width:s,height:s})>a)return null;for(n=0;n<5;++n)for(h[n]=[],i=0;i<5;++i)h[n][i]=CV.countNonZero(t,{x:(i+1)*s,y:(n+1)*s,width:s,height:s})>a?1:0;for(c[0]=h,f[0]=this.hammingDistance(c[0]),e={first:f[0],second:0},n=1;n<4;++n)c[n]=this.rotate(c[n-1]),f[n]=this.hammingDistance(c[n]),f[n]<e.first&&(e.first=f[n],e.second=n);return 0!==e.first?null:new AR.Marker(this.mat2id(c[e.second]),this.rotate2(r,4-e.second))},AR.Detector.prototype.hammingDistance=function(t){var r,e,o,n,i,s=[[1,0,0,0,0],[1,0,1,1,1],[0,1,0,0,1],[0,1,1,1,0]],a=0;for(o=0;o<5;++o){for(e=1/0,n=0;n<4;++n){for(r=0,i=0;i<5;++i)r+=t[o][i]===s[n][i]?0:1;r<e&&(e=r)}a+=e}return a},AR.Detector.prototype.mat2id=function(t){var r,e=0;for(r=0;r<5;++r)e<<=1,e|=t[r][1],e<<=1,e|=t[r][3];return e},AR.Detector.prototype.rotate=function(t){var r,e,o=[],n=t.length;for(r=0;r<n;++r)for(o[r]=[],e=0;e<t[r].length;++e)o[r][e]=t[t[r].length-e-1][r];return o},AR.Detector.prototype.rotate2=function(t,r){var e,o=[],n=t.length;for(e=0;e<n;++e)o[e]=t[(r+e)%n];return o},module.exports=AR,(SVD=SVD||{}).svdcmp=function(t,r,e,o,n){var i,s,a,h,c,f,u,d,l,V,x,v,y,p,m,g=0,b=0,M=0,w=[];for(s=0;s<e;++s){if(u=s+1,w[s]=M*b,b=v=M=0,s<r){for(f=s;f<r;++f)M+=Math.abs(t[f][s]);if(0!==M){for(f=s;f<r;++f)t[f][s]/=M,v+=t[f][s]*t[f][s];for(x=(V=t[s][s])*(b=-SVD.sign(Math.sqrt(v),V))-v,t[s][s]=V-b,h=u;h<e;++h){for(v=0,f=s;f<r;++f)v+=t[f][s]*t[f][h];for(V=v/x,f=s;f<r;++f)t[f][h]+=V*t[f][s]}for(f=s;f<r;++f)t[f][s]*=M}}if(o[s]=M*b,b=v=M=0,s<r&&s!==e-1){for(f=u;f<e;++f)M+=Math.abs(t[s][f]);if(0!==M){for(f=u;f<e;++f)t[s][f]/=M,v+=t[s][f]*t[s][f];for(x=(V=t[s][u])*(b=-SVD.sign(Math.sqrt(v),V))-v,t[s][u]=V-b,f=u;f<e;++f)w[f]=t[s][f]/x;for(h=u;h<r;++h){for(v=0,f=u;f<e;++f)v+=t[h][f]*t[s][f];for(f=u;f<e;++f)t[h][f]+=v*w[f]}for(f=u;f<e;++f)t[s][f]*=M}}g=Math.max(g,Math.abs(o[s])+Math.abs(w[s]))}for(s=e-1;s>=0;--s){if(s<e-1){if(0!==b){for(h=u;h<e;++h)n[h][s]=t[s][h]/t[s][u]/b;for(h=u;h<e;++h){for(v=0,f=u;f<e;++f)v+=t[s][f]*n[f][h];for(f=u;f<e;++f)n[f][h]+=v*n[f][s]}}for(h=u;h<e;++h)n[s][h]=n[h][s]=0}n[s][s]=1,b=w[s],u=s}for(s=Math.min(e,r)-1;s>=0;--s){for(b=o[s],h=u=s+1;h<e;++h)t[s][h]=0;if(0!==b){for(b=1/b,h=u;h<e;++h){for(v=0,f=u;f<r;++f)v+=t[f][s]*t[f][h];for(V=v/t[s][s]*b,f=s;f<r;++f)t[f][h]+=V*t[f][s]}for(h=s;h<r;++h)t[h][s]*=b}else for(h=s;h<r;++h)t[h][s]=0;++t[s][s]}for(f=e-1;f>=0;--f)for(a=1;a<=30;++a){for(i=!0,u=f;u>=0;--u){if(d=u-1,Math.abs(w[u])+g===g){i=!1;break}if(Math.abs(o[d])+g===g)break}if(i)for(l=0,v=1,s=u;s<=f&&(V=v*w[s],Math.abs(V)+g!==g);++s)for(x=SVD.pythag(V,b=o[s]),o[s]=x,l=b*(x=1/x),v=-V*x,h=1;h<=r;++h)t[h][d]=(p=t[h][d])*l+(m=t[h][s])*v,t[h][s]=m*l-p*v;if(m=o[f],u===f){if(m<0)for(o[f]=-m,h=0;h<e;++h)n[h][f]=-n[h][f];break}if(30===a)return!1;for(y=o[u],b=SVD.pythag(V=(((p=o[d=f-1])-m)*(p+m)+((b=w[d])-(x=w[f]))*(b+x))/(2*x*p),1),V=((y-m)*(y+m)+x*(p/(V+SVD.sign(b,V))-x))/y,l=v=1,h=u;h<=d;++h){for(p=o[s=h+1],x=v*(b=w[s]),b*=l,m=SVD.pythag(V,x),w[h]=m,V=y*(l=V/m)+b*(v=x/m),b=b*l-y*v,x=p*v,p*=l,c=0;c<e;++c)n[c][h]=(y=n[c][h])*l+(m=n[c][s])*v,n[c][s]=m*l-y*v;for(m=SVD.pythag(V,x),o[h]=m,0!==m&&(l=V*(m=1/m),v=x*m),V=l*b+v*p,y=l*p-v*b,c=0;c<r;++c)t[c][h]=(p=t[c][h])*l+(m=t[c][s])*v,t[c][s]=m*l-p*v}w[u]=0,w[f]=V,o[f]=y}return!0},SVD.pythag=function(t,r){var e,o=Math.abs(t),n=Math.abs(r);return o>n?(e=n/o,o*Math.sqrt(1+e*e)):0===n?0:(e=o/n,n*Math.sqrt(1+e*e))},SVD.sign=function(t,r){return r>=0?Math.abs(t):-Math.abs(t)},module.exports=SVD;var POS,SVD=require("./svd");(POS=POS||{}).Posit=function(t,r){this.objectPoints=this.buildModel(t),this.focalLength=r,this.objectVectors=[],this.objectNormal=[],this.objectMatrix=[[],[],[]],this.init()},POS.Posit.prototype.buildModel=function(t){var r=t/2;return[[-r,r,0],[r,r,0],[r,-r,0],[-r,-r,0]]},POS.Posit.prototype.init=function(){var t,r=this.objectPoints.length,e=[],o=[],n=0,i=2;for(t=0;t<r;++t)this.objectVectors[t]=[this.objectPoints[t][0]-this.objectPoints[0][0],this.objectPoints[t][1]-this.objectPoints[0][1],this.objectPoints[t][2]-this.objectPoints[0][2]],e[t]=[this.objectVectors[t][0],this.objectVectors[t][1],this.objectVectors[t][2]];for(;0===n;)o[0]=this.objectVectors[1][1]*this.objectVectors[i][2]-this.objectVectors[1][2]*this.objectVectors[i][1],o[1]=this.objectVectors[1][2]*this.objectVectors[i][0]-this.objectVectors[1][0]*this.objectVectors[i][2],o[2]=this.objectVectors[1][0]*this.objectVectors[i][1]-this.objectVectors[1][1]*this.objectVectors[i][0],n=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]),++i;for(t=0;t<3;++t)this.objectNormal[t]=o[t]/n;POS.pseudoInverse(e,r,this.objectMatrix)},POS.Posit.prototype.pose=function(t){var r,e,o,n,i,s,a=[[],[],[]],h=[[],[],[]],c=[],f=[[],[],[]],u=[[],[],[]],d=[],l=[];for(this.pos(t,a,h,c),r=(o=this.isValid(a,c))?this.iterate(t,a,c,f,d):{euclidean:-1,pixels:-1,maximum:-1},e=(n=this.isValid(h,c))?this.iterate(t,h,c,u,l):{euclidean:-1,pixels:-1,maximum:-1},i=0;i<3;++i)for(s=0;s<3;++s)o&&(d[i]-=f[i][s]*this.objectPoints[0][s]),n&&(l[i]-=u[i][s]*this.objectPoints[0][s]);return r.euclidean<e.euclidean?new POS.Pose(r.pixels,f,d,e.pixels,u,l):new POS.Pose(e.pixels,u,l,r.pixels,f,d)},POS.Posit.prototype.pos=function(t,r,e,o){var n,i,s,a,h,c,f,u,d,l,V=this.objectPoints.length,x=[],v=[],y=[],p=[],m=[],g=[],b=[],M=[];for(d=0;d<V;++d)x[d]=[t[d].x-t[0].x,t[d].y-t[0].y];for(d=0;d<3;++d)for(v[d]=0,y[d]=0,l=0;l<V;++l)v[d]+=this.objectMatrix[d][l]*x[l][0],y[d]+=this.objectMatrix[d][l]*x[l][1];for(a=((i=y[0]*y[0]+y[1]*y[1]+y[2]*y[2])-(n=v[0]*v[0]+v[1]*v[1]+v[2]*v[2]))*(i-n)+(s=v[0]*y[0]+v[1]*y[1]+v[2]*y[2])*s*4,f=(h=i-n>=0?(i-n+Math.sqrt(a))/2:(i-n-Math.sqrt(a))/2)>=0?0===(c=Math.sqrt(h))?0:-s/c:0===(c=Math.sqrt(-s*s/h))?Math.sqrt(n-i):-s/c,d=0;d<3;++d)p[d]=v[d]+c*this.objectNormal[d],m[d]=y[d]+f*this.objectNormal[d];for(u=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]),d=0;d<3;++d)g[d]=p[d]/u,b[d]=m[d]/u;for(M[0]=g[1]*b[2]-g[2]*b[1],M[1]=g[2]*b[0]-g[0]*b[2],M[2]=g[0]*b[1]-g[1]*b[0],d=0;d<3;++d)r[0][d]=g[d],r[1][d]=b[d],r[2][d]=M[d];for(d=0;d<3;++d)p[d]=v[d]-c*this.objectNormal[d],m[d]=y[d]-f*this.objectNormal[d];for(d=0;d<3;++d)g[d]=p[d]/u,b[d]=m[d]/u;for(M[0]=g[1]*b[2]-g[2]*b[1],M[1]=g[2]*b[0]-g[0]*b[2],M[2]=g[0]*b[1]-g[1]*b[0],d=0;d<3;++d)e[0][d]=g[d],e[1][d]=b[d],e[2][d]=M[d];o[0]=t[0].x/u,o[1]=t[0].y/u,o[2]=this.focalLength/u},POS.Posit.prototype.isValid=function(t,r){for(var e,o=this.objectPoints.length,n=1/0,i=0;i<o;++i)(e=r[2]+(t[2][0]*this.objectVectors[i][0]+t[2][1]*this.objectVectors[i][1]+t[2][2]*this.objectVectors[i][2]))<n&&(n=e);return n>=0},POS.Posit.prototype.iterate=function(t,r,e,o,n){var i,s,a,h,c,f,u,d,l,V=this.objectPoints.length,x=[],v=[],y=[[],[],[]],p=[[],[],[]],m=[],g=[],b=!1,M=0;for(d=0;d<V;++d)x[d]={x:t[d].x,y:t[d].y};for(d=0;d<3;++d){for(l=0;l<3;++l)o[d][l]=r[d][l];n[d]=e[d]}for(d=0;d<V;++d){for(a=0,l=0;l<3;++l)a+=this.objectVectors[d][l]*o[2][l]/n[2];v[d]={x:(1+a)*t[d].x,y:(1+a)*t[d].y}}for(s=0,d=0;d<V;++d)s+=Math.abs(v[d].x-x[d].x),s+=Math.abs(v[d].y-x[d].y);for(d=0;d<3;++d)m[d]=n[d]-(o[d][0]*this.objectPoints[0][0]+o[d][1]*this.objectPoints[0][1]+o[d][2]*this.objectPoints[0][2]);for(h=c=this.error(t,o,m),b=0===c.pixels||s<.01;M++<100&&!b;){for(d=0;d<V;++d)x[d].x=v[d].x,x[d].y=v[d].y;for(this.pos(v,y,p,n),d=0;d<3;++d)m[d]=n[d]-(y[d][0]*this.objectPoints[0][0]+y[d][1]*this.objectPoints[0][1]+y[d][2]*this.objectPoints[0][2]),g[d]=n[d]-(p[d][0]*this.objectPoints[0][0]+p[d][1]*this.objectPoints[0][1]+p[d][2]*this.objectPoints[0][2]);if(c=this.error(t,y,m),f=this.error(t,p,g),c.euclidean>=0&&f.euclidean>=0)if(f.euclidean<c.euclidean)for(h=f,d=0;d<3;++d)for(l=0;l<3;++l)o[d][l]=p[d][l];else for(h=c,d=0;d<3;++d)for(l=0;l<3;++l)o[d][l]=y[d][l];if(c.euclidean<0&&f.euclidean>=0)for(h=f,d=0;d<3;++d)for(l=0;l<3;++l)o[d][l]=p[d][l];if(f.euclidean<0&&c.euclidean>=0)for(h=c,d=0;d<3;++d)for(l=0;l<3;++l)o[d][l]=y[d][l];for(d=0;d<V;++d){for(a=0,l=0;l<3;++l)a+=this.objectVectors[d][l]*o[2][l]/n[2];v[d].x=(1+a)*t[d].x,v[d].y=(1+a)*t[d].y}for(i=s,s=0,d=0;d<V;++d)s+=Math.abs(v[d].x-x[d].x),s+=Math.abs(v[d].y-x[d].y);u=Math.abs(s-i),b=0===h.pixels||u<.01}return h},POS.Posit.prototype.error=function(t,r,e){var o,n,i,s=this.objectPoints.length,a=[],h=[],c=[],f=0,u=0,d=0;if(!this.isValid(r,e))return{euclidean:-1,pixels:-1,maximum:-1};for(o=0;o<s;++o)for(a[o]=[],n=0;n<3;++n)a[o][n]=e[n];for(o=0;o<s;++o)for(n=0;n<3;++n)for(i=0;i<3;++i)a[o][n]+=r[n][i]*this.objectPoints[o][i];for(o=0;o<s;++o)for(h[o]=[],n=0;n<2;++n)h[o][n]=this.focalLength*a[o][n]/a[o][2];for(o=0;o<s;++o)c[o]=[h[o][0]-t[o].x,h[o][1]-t[o].y];for(o=0;o<s;++o)f+=Math.sqrt(c[o][0]*c[o][0]+c[o][1]*c[o][1]),u+=Math.abs(Math.round(h[o][0])-Math.round(t[o].x))+Math.abs(Math.round(h[o][1])-Math.round(t[o].y)),Math.abs(c[o][0])>d&&(d=Math.abs(c[o][0])),Math.abs(c[o][1])>d&&(d=Math.abs(c[o][1]));return{euclidean:f/s,pixels:u,maximum:d}},POS.pseudoInverse=function(t,r,e){var o,n,i,s=[],a=[[],[],[]],h=[[],[],[]],c=0,f=0;for(SVD.svdcmp(t,r,3,s,a),o=0;o<3;++o)s[o]>c&&(c=s[o]);for(c*=.01,o=0;o<3;++o)s[o]<c&&(s[o]=0);for(n=0;n<3;++n)if(0===s[n])for(++f,i=n;i<2;++i){for(o=0;o<r;++o)t[o][i]=t[o][i+1];for(o=0;o<3;++o)a[o][i]=a[o][i+1]}for(n=0;n<2;++n)0===s[n]&&(s[n]=s[n+1]);for(o=0;o<3;++o)for(n=0;n<3-f;++n)h[o][n]=a[o][n]/s[n];for(o=0;o<3;++o)for(n=0;n<r;++n)for(e[o][n]=0,i=0;i<3-f;++i)e[o][n]+=h[o][i]*t[n][i]},POS.Pose=function(t,r,e,o,n,i){this.bestError=t,this.bestRotation=r,this.bestTranslation=e,this.alternativeError=o,this.alternativeRotation=n,this.alternativeTranslation=i},module.exports=POS,SVD=require("./svd"),(POS=POS||{}).Posit=function(t,r){this.model=this.buildModel(t),this.focalLength=r,this.init()},POS.Posit.prototype.buildModel=function(t){var r=t/2;return[new Vec3(-r,r,0),new Vec3(r,r,0),new Vec3(r,-r,0),new Vec3(-r,-r,0)]},POS.Posit.prototype.init=function(){var t,r=new Vec3,e=new Mat3;this.modelVectors=Mat3.fromRows(Vec3.sub(this.model[1],this.model[0]),Vec3.sub(this.model[2],this.model[0]),Vec3.sub(this.model[3],this.model[0])),t=Mat3.clone(this.modelVectors),SVD.svdcmp(t.m,3,3,r.v,e.m),this.modelPseudoInverse=Mat3.mult(Mat3.mult(e,Mat3.fromDiagonal(Vec3.inverse(r))),Mat3.transpose(t)),this.modelNormal=e.column(r.minIndex())},POS.Posit.prototype.pose=function(t){var r,e,o=new Vec3(1,1,1),n=new Mat3,i=new Mat3,s=new Vec3,a=new Vec3;return this.pos(t,o,n,i,s,a),(r=this.iterate(t,n,s))<(e=this.iterate(t,i,a))?new POS.Pose(r,n.m,s.v,e,i.m,a.v):new POS.Pose(e,i.m,a.v,r,n.m,s.v)},POS.Posit.prototype.pos=function(t,r,e,o,n,i){var s,a,h,c,f,u,d,l,V,x=new Vec3(t[1].x,t[2].x,t[3].x),v=new Vec3(t[1].y,t[2].y,t[3].y),y=Vec3.addScalar(Vec3.mult(x,r),-t[0].x),p=Vec3.addScalar(Vec3.mult(v,r),-t[0].y),m=Mat3.multVector(this.modelPseudoInverse,y),g=Mat3.multVector(this.modelPseudoInverse,p),b=g.square()-m.square(),M=Vec3.dot(m,g),w=0,P=0;0===b?(w=Math.sqrt(Math.abs(2*M)),P=-Math.PI/2*(M<0?-1:M>0?1:0)):(w=Math.sqrt(Math.sqrt(b*b+4*M*M)),P=Math.atan(-2*M/b),b<0&&(P+=Math.PI),P/=2),l=w*Math.cos(P),V=w*Math.sin(P),s=Vec3.add(m,Vec3.multScalar(this.modelNormal,l)),a=Vec3.add(g,Vec3.multScalar(this.modelNormal,V)),c=s.normalize(),f=a.normalize(),h=Vec3.cross(s,a),e.copy(Mat3.fromRows(s,a,h)),u=(c+f)/2,d=Mat3.multVector(e,this.model[0]),n.v=[t[0].x/u-d.v[0],t[0].y/u-d.v[1],this.focalLength/u],s=Vec3.sub(m,Vec3.multScalar(this.modelNormal,l)),a=Vec3.sub(g,Vec3.multScalar(this.modelNormal,V)),c=s.normalize(),f=a.normalize(),h=Vec3.cross(s,a),o.copy(Mat3.fromRows(s,a,h)),u=(c+f)/2,d=Mat3.multVector(o,this.model[0]),i.v=[t[0].x/u-d.v[0],t[0].y/u-d.v[1],this.focalLength/u]},POS.Posit.prototype.iterate=function(t,r,e){for(var o,n,i,s,a=1/0,h=new Mat3,c=new Mat3,f=new Vec3,u=new Vec3,d=0;d<100&&(o=Vec3.addScalar(Vec3.multScalar(Mat3.multVector(this.modelVectors,r.row(2)),1/e.v[2]),1),this.pos(t,o,h,c,f,u),(i=this.getError(t,h,f))<(s=this.getError(t,c,u))?(r.copy(h),e.copy(f),n=i):(r.copy(c),e.copy(u),n=s),!(n<=2||n>a));++d)a=n;return n},POS.Posit.prototype.getError=function(t,r,e){var o,n,i,s,a,h,c,f,u,d=Vec3.add(Mat3.multVector(r,this.model[0]),e),l=Vec3.add(Mat3.multVector(r,this.model[1]),e),V=Vec3.add(Mat3.multVector(r,this.model[2]),e),x=Vec3.add(Mat3.multVector(r,this.model[3]),e);return l=l.v,V=V.v,x=x.v,(d=d.v)[0]*=this.focalLength/d[2],d[1]*=this.focalLength/d[2],l[0]*=this.focalLength/l[2],l[1]*=this.focalLength/l[2],V[0]*=this.focalLength/V[2],V[1]*=this.focalLength/V[2],x[0]*=this.focalLength/x[2],x[1]*=this.focalLength/x[2],o=[{x:d[0],y:d[1]},{x:l[0],y:l[1]},{x:V[0],y:V[1]},{x:x[0],y:x[1]}],n=this.angle(t[0],t[1],t[3]),i=this.angle(t[1],t[2],t[0]),s=this.angle(t[2],t[3],t[1]),a=this.angle(t[3],t[0],t[2]),h=this.angle(o[0],o[1],o[3]),c=this.angle(o[1],o[2],o[0]),f=this.angle(o[2],o[3],o[1]),u=this.angle(o[3],o[0],o[2]),(Math.abs(n-h)+Math.abs(i-c)+Math.abs(s-f)+Math.abs(a-u))/4},POS.Posit.prototype.angle=function(t,r,e){var o=r.x-t.x,n=r.y-t.y,i=e.x-t.x,s=e.y-t.y;return 180*Math.acos((o*i+n*s)/(Math.sqrt(o*o+n*n)*Math.sqrt(i*i+s*s)))/Math.PI},POS.Pose=function(t,r,e,o,n,i){this.bestError=t,this.bestRotation=r,this.bestTranslation=e,this.alternativeError=o,this.alternativeRotation=n,this.alternativeTranslation=i};var Vec3=function(t,r,e){this.v=[t||0,r||0,e||0]};Vec3.prototype.copy=function(t){var r=this.v;return r[0]=(t=t.v)[0],r[1]=t[1],r[2]=t[2],this},Vec3.add=function(t,r){var e=new Vec3,o=e.v;return o[0]=(t=t.v)[0]+(r=r.v)[0],o[1]=t[1]+r[1],o[2]=t[2]+r[2],e},Vec3.sub=function(t,r){var e=new Vec3,o=e.v;return o[0]=(t=t.v)[0]-(r=r.v)[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],e},Vec3.mult=function(t,r){var e=new Vec3,o=e.v;return o[0]=(t=t.v)[0]*(r=r.v)[0],o[1]=t[1]*r[1],o[2]=t[2]*r[2],e},Vec3.addScalar=function(t,r){var e=new Vec3,o=e.v;return o[0]=(t=t.v)[0]+r,o[1]=t[1]+r,o[2]=t[2]+r,e},Vec3.multScalar=function(t,r){var e=new Vec3,o=e.v;return o[0]=(t=t.v)[0]*r,o[1]=t[1]*r,o[2]=t[2]*r,e},Vec3.dot=function(t,r){return(t=t.v)[0]*(r=r.v)[0]+t[1]*r[1]+t[2]*r[2]},Vec3.cross=function(t,r){return new Vec3((t=t.v)[1]*(r=r.v)[2]-t[2]*r[1],t[2]*r[0]-t[0]*r[2],t[0]*r[1]-t[1]*r[0])},Vec3.prototype.normalize=function(){var t=this.v,r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return r>0&&(t[0]/=r,t[1]/=r,t[2]/=r),r},Vec3.inverse=function(t){var r=new Vec3,e=r.v;return 0!==(t=t.v)[0]&&(e[0]=1/t[0]),0!==t[1]&&(e[1]=1/t[1]),0!==t[2]&&(e[2]=1/t[2]),r},Vec3.prototype.square=function(){var t=this.v;return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},Vec3.prototype.minIndex=function(){var t=this.v;return t[0]<t[1]?t[0]<t[2]?0:2:t[1]<t[2]?1:2};var Mat3=function(){this.m=[[0,0,0],[0,0,0],[0,0,0]]};Mat3.clone=function(t){var r=new Mat3,e=r.m;return e[0][0]=(t=t.m)[0][0],e[0][1]=t[0][1],e[0][2]=t[0][2],e[1][0]=t[1][0],e[1][1]=t[1][1],e[1][2]=t[1][2],e[2][0]=t[2][0],e[2][1]=t[2][1],e[2][2]=t[2][2],r},Mat3.prototype.copy=function(t){var r=this.m;return r[0][0]=(t=t.m)[0][0],r[0][1]=t[0][1],r[0][2]=t[0][2],r[1][0]=t[1][0],r[1][1]=t[1][1],r[1][2]=t[1][2],r[2][0]=t[2][0],r[2][1]=t[2][1],r[2][2]=t[2][2],this},Mat3.fromRows=function(t,r,e){var o=new Mat3,n=o.m;return r=r.v,e=e.v,n[0][0]=(t=t.v)[0],n[0][1]=t[1],n[0][2]=t[2],n[1][0]=r[0],n[1][1]=r[1],n[1][2]=r[2],n[2][0]=e[0],n[2][1]=e[1],n[2][2]=e[2],o},Mat3.fromDiagonal=function(t){var r=new Mat3,e=r.m;return e[0][0]=(t=t.v)[0],e[1][1]=t[1],e[2][2]=t[2],r},Mat3.transpose=function(t){var r=new Mat3,e=r.m;return e[0][0]=(t=t.m)[0][0],e[0][1]=t[1][0],e[0][2]=t[2][0],e[1][0]=t[0][1],e[1][1]=t[1][1],e[1][2]=t[2][1],e[2][0]=t[0][2],e[2][1]=t[1][2],e[2][2]=t[2][2],r},Mat3.mult=function(t,r){var e=new Mat3,o=e.m;return o[0][0]=(t=t.m)[0][0]*(r=r.m)[0][0]+t[0][1]*r[1][0]+t[0][2]*r[2][0],o[0][1]=t[0][0]*r[0][1]+t[0][1]*r[1][1]+t[0][2]*r[2][1],o[0][2]=t[0][0]*r[0][2]+t[0][1]*r[1][2]+t[0][2]*r[2][2],o[1][0]=t[1][0]*r[0][0]+t[1][1]*r[1][0]+t[1][2]*r[2][0],o[1][1]=t[1][0]*r[0][1]+t[1][1]*r[1][1]+t[1][2]*r[2][1],o[1][2]=t[1][0]*r[0][2]+t[1][1]*r[1][2]+t[1][2]*r[2][2],o[2][0]=t[2][0]*r[0][0]+t[2][1]*r[1][0]+t[2][2]*r[2][0],o[2][1]=t[2][0]*r[0][1]+t[2][1]*r[1][1]+t[2][2]*r[2][1],o[2][2]=t[2][0]*r[0][2]+t[2][1]*r[1][2]+t[2][2]*r[2][2],e},Mat3.multVector=function(t,r){return new Vec3((t=t.m)[0][0]*(r=r.v)[0]+t[0][1]*r[1]+t[0][2]*r[2],t[1][0]*r[0]+t[1][1]*r[1]+t[1][2]*r[2],t[2][0]*r[0]+t[2][1]*r[1]+t[2][2]*r[2])},Mat3.prototype.column=function(t){var r=this.m;return new Vec3(r[0][t],r[1][t],r[2][t])},Mat3.prototype.row=function(t){var r=this.m;return new Vec3(r[t][0],r[t][1],r[t][2])},module.exports=POS;